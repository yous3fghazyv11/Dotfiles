#!/usr/bin/env bash
# record-wayland.sh â€” Works on GNOME, KDE, Hyprland, Sway, Niri, etc.

OUTPUT="${1:-recording_$(date +%F_%H-%M-%S).mkv}"
FPS=30
BITRATE=6000K
AUDIO_DEVICE="default"

echo "ðŸŽ¥ Select the screen or window to capture in the popup that appears."

ffmpeg \
    -f pipewire -i "$(pw-record --list-targets | grep -oP '(?<=id: )[0-9]+' | head -n1)" \
    -f pulse -i "$AUDIO_DEVICE" \
    -vaapi_device /dev/dri/renderD128 \
    -vf 'format=nv12,hwupload' \
    -c:v h264_vaapi -b:v "$BITRATE" -r "$FPS" \
    -c:a aac -b:a 160k \
    -y "$OUTPUT"
